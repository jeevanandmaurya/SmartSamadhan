<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civic Issue Reporting System Flowchart</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <h1>Civic Issue Reporting System Architecture and Flow</h1>
    <div class="mermaid">
        flowchart TD
            A[User/Citizen Registers/Login] --> B[Supabase Auth]
            B --> C{User Role?}
            C -->|User| D[User Dashboard]
            C -->|Admin| E[Admin Dashboard]

            D --> F[Lodge Complaint Form]
            F --> G[Select Category: Roads/Sanitation/Water/etc]
            G --> H[Add Location via GPS/Map]
            H --> I[Upload Attachments to Supabase Storage]
            I --> J[Submit to complaints table]
            J --> K[Confirmation with Reference Number]

            E --> L[View Interactive Map with Complaint Pins]
            L --> M[Filter by Status/Priority/Department]
            M --> N[View Complaint Details]
            N --> O{Action?}
            O -->|Assign| P[Assign to Department]
            O -->|Update| Q[Update Status & Add Notes]
            P --> R[Send Updates to updates JSONB]
            Q --> R
            R --> S[Generate Analytics Reports]
            S --> T[Export Data]

            subgraph "Frontend (React)"
                U[App.jsx - Routing]
                V[AuthContext - Supabase Auth]
                W[DatabaseContext - CRUD Operations]
                X[LodgeComplain Component]
                Y[InteractiveMap Component]
                Z[ManageReports Component]
            end

            subgraph "Backend (Supabase)"
                AA[auth.users - Authentication]
                BB[public.users - User Profiles]
                CC[public.admins - Admin Profiles]
                DD[public.complaints - Issue Reports]
                EE[Storage Bucket - Attachments]
            end

            subgraph "Database Schema"
                FF[users: id, full_name, email, phone, address]
                GG[admins: id, full_name, email, department, access_level]
                HH[complaints: id, user_id, title, description, status, priority, category, location, latitude, longitude, attachments, updates]
            end

            U --> V
            V --> W
            W --> X
            W --> Y
            W --> Z

            X --> J
            Y --> L
            Z --> N

            B --> AA
            F --> BB
            E --> CC
            J --> DD
            I --> EE

            BB --> FF
            CC --> GG
            DD --> HH
    </div>
</body>
</html>
